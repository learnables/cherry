



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://learnables.github.io/cherry/">
      
      
        <meta name="author" content="SÃ©b Arnold">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicons/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-4.6.3">
    
    
      
        <title>cherry</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
    
      <link rel="stylesheet" href="assets/css/custom.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-68693545-3", "seba-1511.github.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#overview-and-examples" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://learnables.github.io/cherry/" title="cherry" aria-label="cherry" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="assets/images/cherry_cropped.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              cherry
            </span>
            <span class="md-header-nav__topic">
              
                Home
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/learnables/cherry" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    learnables/cherry
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://learnables.github.io/cherry/" title="cherry" class="md-nav__button md-logo">
      
        <img alt="logo" src="assets/images/cherry_cropped.png" width="48" height="48">
      
    </a>
    cherry
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/learnables/cherry" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    learnables/cherry
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-and-examples" class="md-nav__link">
    Overview and Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-cherrynnpolicy" class="md-nav__link">
    Defining a cherry.nn.Policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-cherryexperiencereplay-of-cherrytransition" class="md-nav__link">
    Building a cherry.ExperienceReplay of cherry.Transition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#designing-algorithms-with-cherrytd-cherrypg-and-cherryalgorithms" class="md-nav__link">
    Designing algorithms with cherry.td, cherry.pg, and cherry.algorithms
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changelog" class="md-nav__link">
    Changelog
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    Contributing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    Acknowledgements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-cherry" class="md-nav__link">
    Why 'cherry' ?
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="tutorials/getting_started/" title="Getting Started with Cherry" class="md-nav__link">
      Getting Started with Cherry
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry/" title="cherry" class="md-nav__link">
      cherry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.algorithms/" title="cherry.algorithms" class="md-nav__link">
      cherry.algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.debug/" title="cherry.debug" class="md-nav__link">
      cherry.debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.distributions/" title="cherry.distributions" class="md-nav__link">
      cherry.distributions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.envs/" title="cherry.envs" class="md-nav__link">
      cherry.envs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.models/" title="cherry.models" class="md-nav__link">
      cherry.models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.nn/" title="cherry.nn" class="md-nav__link">
      cherry.nn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.nn.init/" title="cherry.nn.init" class="md-nav__link">
      cherry.nn.init
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.optim/" title="cherry.optim" class="md-nav__link">
      cherry.optim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.pg/" title="cherry.pg" class="md-nav__link">
      cherry.pg
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.plot/" title="cherry.plot" class="md-nav__link">
      cherry.plot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.td/" title="cherry.td" class="md-nav__link">
      cherry.td
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api/cherry.wrappers/" title="cherry.wrappers" class="md-nav__link">
      cherry.wrappers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/learnables/cherry/tree/master/examples" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/learnables/cherry/" title="GitHub" class="md-nav__link">
      GitHub
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-and-examples" class="md-nav__link">
    Overview and Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-cherrynnpolicy" class="md-nav__link">
    Defining a cherry.nn.Policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-cherryexperiencereplay-of-cherrytransition" class="md-nav__link">
    Building a cherry.ExperienceReplay of cherry.Transition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#designing-algorithms-with-cherrytd-cherrypg-and-cherryalgorithms" class="md-nav__link">
    Designing algorithms with cherry.td, cherry.pg, and cherry.algorithms
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changelog" class="md-nav__link">
    Changelog
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    Contributing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    Acknowledgements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-cherry" class="md-nav__link">
    Why 'cherry' ?
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Home</h1>
                
                <p align="center"><img src="http://cherry-rl.net/assets/images/cherry_full.png" height="128px" /></p>

<hr />
<p><a href="https://travis-ci.org/learnables/cherry"><img alt="Build Status" src="https://travis-ci.org/learnables/cherry.svg?branch=master" /></a></p>
<p>Cherry is a reinforcement learning framework for researchers built on top of PyTorch.</p>
<p>Unlike other reinforcement learning implementations, cherry doesn't implement a single monolithic  interface to existing algorithms.
Instead, it provides you with low-level, common tools to write your own algorithms.
Drawing from the UNIX philosophy, each tool strives to be as independent from the rest of the framework as possible.
So if you don't like a specific tool, you donât need to use it.</p>
<p><strong>Features</strong></p>
<p>Cherry extends PyTorch with only a handful of new core concepts.</p>
<ul>
<li>PyTorch modules for reinforcement learning: <ul>
<li><a href="http://cherry-rl.net/api/cherry.nn/#cherry.nn.policy.Policy"><code>cherry.nn.Policy</code></a>: base class for <script type="math/tex">\pi(a \mid s)</script> policies.</li>
<li><a href="http://cherry-rl.net/api/cherry.nn/#cherry.nn.action_value.ActionValue"><code>cherry.nn.ActionValue</code></a>: base class for <script type="math/tex">Q(s, a)</script> action-value functions.</li>
</ul>
</li>
<li>Data structures for reinforcement learning compatible with PyTorch:<ul>
<li><a href="http://cherry-rl.net/api/cherry/#cherry.experience_replay.Transition"><code>cherry.Transition</code></a>: namedtuple to store <script type="math/tex">(s_t, a_t, r_t, s_{t+1})</script> transitions (and more).</li>
<li><a href="http://cherry-rl.net/api/cherry/#cherry.experience_replay.ExperienceReplay"><code>cherry.ExperienceReplay</code></a>: a list-like buffer to store and sample transitions.</li>
</ul>
</li>
<li>Low-level interface <em>Ã  la</em> PyTorch to write and debug your algorithms.<ul>
<li><a href="http://cherry-rl.net/api/cherry.td/"><code>cherry.td.*</code></a> and <a href="http://cherry-rl.net/api/cherry.pg/"><code>cherry.pg.*</code></a>: temporal difference and policy gradient utilities.</li>
<li><a href="http://cherry-rl.net/api/cherry.algorithms/"><code>cherry.algorithms.*</code></a>: helper functions for popular algorithms (<a href="http://cherry-rl.net/api/cherry.algorithms/#cherry.algorithms.ppo.PPO">PPO</a>, <a href="http://cherry-rl.net/api/cherry.algorithms/#cherry.algorithms.td3.TD3">TD3</a>, <a href="http://cherry-rl.net/api/cherry.algorithms/#cherry.algorithms.drq.DrQ">DrQ</a>, and <a href="http://cherry-rl.net/api/cherry.algorithms/">more</a>).</li>
<li><a href="http://cherry-rl.net/api/cherry.debug/"><code>cherry.debug.*</code></a> and <a href="http://cherry-rl.net/api/cherry.plot/"><code>cherry.plot.*</code></a>: logging, visualization, and debugging tools.</li>
</ul>
</li>
</ul>
<p>To learn more about the tools and philosophy behind cherry, check out our <a href="http://cherry-rl.net/tutorials/getting_started/">Getting Started tutorial</a>.</p>
<h2 id="overview-and-examples">Overview and Examples<a class="headerlink" href="#overview-and-examples" title="Permanent link">&para;</a></h2>
<p>The following snippet showcases a few of the tools offered by cherry.
Many more high-quality examples are available in the <a href="./examples/">examples/</a> folder.</p>
<h4 id="defining-a-cherrynnpolicy">Defining a <a href="http://cherry-rl.net/api/cherry.nn/#cherry.nn.policy.Policy"><code>cherry.nn.Policy</code></a><a class="headerlink" href="#defining-a-cherrynnpolicy" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VisionPolicy</span><span class="p">(</span><span class="n">cherry</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Policy</span><span class="p">):</span>  <span class="c1"># inherits from torch.nn.Module</span>

   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_extractor</span><span class="p">,</span> <span class="n">actor</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">VisionGaussianPolicy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">feature_extractor</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">actor</span> <span class="o">=</span> <span class="n">actor</span>

   <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
      <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
      <span class="n">std</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">cherry</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">TanhNormal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>  <span class="c1"># policies always return a distribution</span>

<span class="n">policy</span> <span class="o">=</span> <span class="n">VisionPolicy</span><span class="p">(</span><span class="n">MyResnetExtractor</span><span class="p">(),</span> <span class="n">MyMLPActor</span><span class="p">())</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>  <span class="c1"># sampled from policy&#39;s distribution</span>
<span class="n">deterministic_action</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># distribution&#39;s mode</span>
<span class="n">action_distribution</span> <span class="o">=</span> <span class="n">policy</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>  <span class="c1"># work with the policy&#39;s distribution</span>
</code></pre></div>
<h4 id="building-a-cherryexperiencereplay-of-cherrytransition">Building a <a href="http://cherry-rl.net/api/cherry/#cherry.experience_replay.ExperienceReplay"><code>cherry.ExperienceReplay</code></a> of <a href="http://cherry-rl.net/api/cherry/#cherry.experience_replay.Transition"><code>cherry.Transition</code></a><a class="headerlink" href="#building-a-cherryexperiencereplay-of-cherrytransition" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># building the replay</span>
<span class="n">replay</span> <span class="o">=</span> <span class="n">cherry</span><span class="o">.</span><span class="n">ExperienceReplay</span><span class="p">()</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
   <span class="n">action</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
   <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
   <span class="n">replay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>
   <span class="n">next_state</span> <span class="o">=</span> <span class="n">state</span>

<span class="c1">#Â manipulating the replay</span>
<span class="n">replay</span> <span class="o">=</span> <span class="n">replay</span><span class="p">[</span><span class="o">-</span><span class="mi">256</span><span class="p">:]</span>  <span class="c1"># indexes like a list</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">replay</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">contiguous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># sample transitions into a replay</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span> <span class="c1"># move replay to device</span>
<span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span> <span class="c1"># iterate over a replay</span>
   <span class="n">transition</span><span class="o">.</span><span class="n">reward</span> <span class="o">*=</span> <span class="mf">0.99</span>

<span class="c1"># get all states, actions, and rewards as PyTorch tensors.</span>
<span class="n">reinforce_loss</span> <span class="o">=</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">policy</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">state</span><span class="p">())</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">action</span><span class="p">())</span> <span class="o">*</span> <span class="n">batch</span><span class="o">.</span><span class="n">reward</span><span class="p">())</span>
</code></pre></div>
<h4 id="designing-algorithms-with-cherrytd-cherrypg-and-cherryalgorithms">Designing algorithms with <a href="http://cherry-rl.net/api/cherry.td/"><code>cherry.td</code></a>, <a href="http://cherry-rl.net/api/cherry.pg/"><code>cherry.pg</code></a>, and <a href="http://cherry-rl.net/api/cherry.algorithms/"><code>cherry.algorithms</code></a><a class="headerlink" href="#designing-algorithms-with-cherrytd-cherrypg-and-cherryalgorithms" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># defining a new algorithm</span>
<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyA2C</span><span class="p">:</span>
   <span class="n">discount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span>

   <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replay</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="n">state_value</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">):</span>
      <span class="c1"># discount rewards</span>
      <span class="n">values</span> <span class="o">=</span> <span class="n">state_value</span><span class="p">(</span><span class="n">replay</span><span class="o">.</span><span class="n">action</span><span class="p">())</span>
      <span class="n">discounted_rewards</span> <span class="o">=</span> <span class="n">cherry</span><span class="o">.</span><span class="n">td</span><span class="o">.</span><span class="n">discount</span><span class="p">(</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">discount</span><span class="p">,</span> <span class="n">replay</span><span class="o">.</span><span class="n">reward</span><span class="p">(),</span> <span class="n">replay</span><span class="o">.</span><span class="n">done</span><span class="p">(),</span> <span class="n">bootstrap</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
      <span class="p">)</span>

      <span class="c1"># Compute losses</span>
      <span class="n">policy_loss</span> <span class="o">=</span> <span class="n">cherry</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">A2C</span><span class="o">.</span><span class="n">policy_loss</span><span class="p">(</span>
         <span class="n">log_probs</span><span class="o">=</span><span class="n">policy</span><span class="p">(</span><span class="n">replay</span><span class="o">.</span><span class="n">state</span><span class="p">())</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">replay</span><span class="o">.</span><span class="n">action</span><span class="p">()),</span>
         <span class="n">advantages</span><span class="o">=</span><span class="n">discounted_rewards</span> <span class="o">-</span> <span class="n">values</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span>
      <span class="p">)</span>
      <span class="n">value_loss</span> <span class="o">=</span> <span class="n">cherry</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">A2C</span><span class="o">.</span><span class="n">state_value_loss</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">discounted_rewards</span><span class="p">)</span>

      <span class="c1"># Optimization step</span>
      <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
      <span class="p">(</span><span class="n">policy_loss</span> <span class="o">+</span> <span class="n">value_loss</span><span class="p">)</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
      <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

<span class="c1"># using MyA2C</span>
<span class="n">my_a2c</span> <span class="o">=</span> <span class="n">MyA2C</span><span class="p">(</span><span class="n">discount</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">my_policy</span> <span class="o">=</span> <span class="n">MyPolicy</span><span class="p">()</span>
<span class="n">linear_value</span> <span class="o">=</span> <span class="n">cherry</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">LinearValue</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="n">adam</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
   <span class="n">replay</span> <span class="o">=</span> <span class="n">collect_experience</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
   <span class="n">my_a2c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replay</span><span class="p">,</span> <span class="n">my_policy</span><span class="p">,</span> <span class="n">linear_value</span><span class="p">,</span> <span class="n">adam</span><span class="p">)</span>
</code></pre></div>
<h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>pip install cherry-rl
</code></pre></div>
<h2 id="changelog">Changelog<a class="headerlink" href="#changelog" title="Permanent link">&para;</a></h2>
<p>A human-readable changelog is available in the <a href="CHANGELOG.md">CHANGELOG.md</a> file.</p>
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h2>
<p>Documentation and tutorials are available on cherryâs website: <a href="http://cherry-rl.net">http://cherry-rl.net</a>.</p>
<h2 id="contributing">Contributing<a class="headerlink" href="#contributing" title="Permanent link">&para;</a></h2>
<p>Here are a couple of guidelines we strive to follow.</p>
<ul>
<li>It's always a good idea to open an issue first, where we can discuss how to best proceed.</li>
<li>If you want to contribute a new example using cherry, it would preferably stand in a single file.</li>
<li>If you would like to contribute a new feature to the core library, we suggest to first implement an example showcasing your new functionality. Doing so is quite useful:<ul>
<li>it allows for automatic testing,</li>
<li>it ensures that the functionality is correctly implemented,</li>
<li>it shows users how to use your functionality, and</li>
<li>it gives a concrete example when discussing the best way to merge your implementation.</li>
</ul>
</li>
</ul>
<h2 id="acknowledgements">Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permanent link">&para;</a></h2>
<p>Cherry draws inspiration from many reinforcement learning implementations, including</p>
<ul>
<li><a href="https://github.com/openai/baselines">OpenAI Baselines</a>,</li>
<li>John Schulman's <a href="https://github.com/joschu/modular_rl">implementations</a></li>
<li>Ilya Kostrikov's <a href="https://github.com/ikostrikov/pytorch-a2c-ppo-acktr">implementations</a>,</li>
<li>Shangtong Zhang's <a href="https://github.com/ShangtongZhang/DeepRL">implementations</a>,</li>
<li>Dave Abel's <a href="https://github.com/david-abel/simple_rl/">implementations</a>,</li>
<li>Vitchyr Pong's <a href="https://github.com/vitchyr/rlkit">implementations</a>,</li>
<li>Kai Arulkumaran's <a href="https://github.com/Kaixhin/spinning-up-basic">implementations</a>,</li>
<li><a href="https://github.com/rll/rllab">RLLab</a> / <a href="https://github.com/rlworkgroup/garage">Garage</a>.</li>
</ul>
<h2 id="why-cherry">Why 'cherry' ?<a class="headerlink" href="#why-cherry" title="Permanent link">&para;</a></h2>
<p>Because it's the sweetest part of <a href="https://twitter.com/ylecun/status/1097532314614034433">the cake</a>.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="tutorials/getting_started/" title="Getting Started with Cherry" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Getting Started with Cherry
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="assets/fonts/font-awesome.css">
    
      <a href="https://github.com/seba-1511" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/seba1511" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/learnables/cherry/issues/new" target="_blank" rel="noopener" title="bug" class="md-footer-social__link fa fa-bug"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.2.4",url:{base:"."}})</script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/mathtex-script-type.min.js"></script>
      
    
  </body>
</html>